--- 
title: "Tutorials for Tidymass shinyapp"
site: bookdown::bookdown_site
documentclass: book
bibliography:
- book.bib
- packages.bib
description: |
  This is a minimal example of using the bookdown package to write a book.
  set in the _output.yml file.
  The HTML output format for this example is bookdown::gitbook,
link-citations: true
github-repo: "rstudio/bookdown-demo"
---

# Installation

[Tidymass shinyapp](https://github.com/tidymass/tidymass_shiny){target="_blank"} is a user-friendly web application for [Tidymass](https://www.tidymass.org/){target="_blank"} that requires little or no programming experience.

The app can be installed via code, docker and server, and we will introduce how to do that step by step in this chapter.

## Install R and Rstudio

To begin with, you need to install R and Rstudio, both of which can be free downloaded from official websites.

If you have installed them before, please ensure that R version > 4.1 as tidymass required, ohterwise download and install the [latest version of R](https://cran.r-project.org/mirrors.html){target="_blank"}.

**Install R**

Download [R](https://www.r-project.org/){target="_blank"} and install it. 

![](figures/R_install.png)

**Install Rstudio**

Download [Rstudio](https://posit.co/download/rstudio-desktop/#download){target="_blank"} and install it.

![](figures/Rstudio_install.png)

**Open the Rstudio**

![](figures/Rstudio.png)

## (For Mac User) Install Cario

Cairo is a 2D graphics library used by R for high-quality plots and needed for Tidymass Shinyapp. On macOS, it requires the X11 system, which is not installed by default. You can follow the following steps if you haven't install Cairo.

First, visit the official website of [XQuartz](https://www.xquartz.org/){target="_blank"} and install it, and this will restart your computer.

![](figures/Cairo.png)

Next, you can install **Cairo** by running the code in Rstudio:

```{r, eval=FALSE}
install.packages("Cairo", type = "source")
```

If the installation is successful, you should be able to library it:

```{r, eval=FALSE}
library(Cairo)
```

## Install Tidymass shinyapp

First, you are recommended to install **Tidymass** with the following code. For more information and guidance, please refer to [Tidymass Website](https://www.tidymass.org/){target="_blank"}

```{r, eval=FALSE}
remotes::install_gitlab("tidymass/tidymass")
```

Second, install the necessary packages:

```{r, eval=FALSE}
if (!require('remotes')) install.packages('remotes');
if (!require('tidyverse')) install.packages('tidyverse');
if (!require('writexl')) install.packages("writexl");
if (!require('hexbin')) install.packages('hexbin')
if (!require('ComplexUpset'))install.packages('ComplexUpset');
if (!require('shinyalert'))install.packages('shinyalert');
if (!require('shinyFiles')) remotes::install_github('thomasp85/shinyFiles');
if (!require('shinyWidgets')) remotes::install_github("dreamRs/shinyWidgets");
if (!require('shiny')) install.packages('shiny');
if (!require('bsicons')) install.packages('bsicons');
if (!require('bslib')) install.packages('bslib');
if (!require('plotly')) install.packages('plotly');
if (!require('colourpicker')) install.packages('colourpicker');
if (!require('massdbbuildin')) remotes::install_github('tidymass/massdbbuildin') 
if (!require('massdatabase')) remotes::install_gitlab("jaspershen/massdatabase")
  
```

Finally, install Tidymass shinyapp with the code:

```{r, eval=FALSE}
remotes::install_github('tidymass/tidymass_shiny')
```


To start the Tidymass shinyapp:

```{r, eval=FALSE}
library(tidyverse)
library(tidymass)
library(tidymassshiny)
run_tidymass_shiny()
```

You should be able to see:

![](figures/shinyapp.png)

## Install docker version

[Docker](https://www.docker.com/){target="_blank"}, a group of platform as a service (PaaS) products, uses OS-level virtualization to provide software in containers. It's useful for individuals who want to share the code, data, and analysis environment with others to repeat their analysis and results.

We provide a docker version of tidymass shinyapp, all the packages in tidymass shinyapp and the dependent packages have been installed.

**Install docker**

You can refer the the [official website](https://www.docker.com/get-started){target="_blank"} to download the docker. Then run docker.

**Pull the tidymassshiny image**

Open your terminal (on Windows, use Command Prompt, PowerShell, or Windows Terminal) and type the following command:

```{r, eval=FALSE}
docker pull tidymass/tidymassshiny:latest
```

**Get the path of the demo data**

Since the Shiny app utilizes `shinyFiles` to obtain file or folder paths, you need to mount your **working directory** into the Docker image when running the Docker version of `tidymassshiny`. Here are instructions.

For macOS systems,  you can get the path for the demo data from `Get Info`, the path may look like `/Users/yijiang/Desktop/Demo_data`. For Windows OS, the path may look like `C:\Users\Yijiang\Documents`. Here you need to copy **Your Own Path**.

![](figures/path.png)

**Ensure Docker Desktop has permission to demo data**

Ensure Docker Desktop has permission to access the drive containing your working directory:

  1. Open **Docker Desktop**.
  2. Go to **Settings > Resources > File Sharing**.
  3. Add the drive or folder (e.g., `/Users/yijiang/Desktop/Demo_data`) to the shared folders list.
  4. Click **Apply & Restart**.

![](figures/docker_set.png)

Please make sure the demo file has the required permissions before proceeding to the next steps. Here are some guidance for [Mac](https://support.apple.com/en-sg/guide/mac-help/mchlp1203/mac){target="_blank"} and [Windows](https://answers.microsoft.com/en-us/windows/forum/all/give-permissions-to-files-and-folders-in-windows/78ee562c-a21f-4a32-8691-73aac1415373){target="_blank"}.

Here replace `/Users/yijiang/Desktop/Demo_data` with **your own path** that you just give permission to the Docker Desktop.

```{r, eval=FALSE}
docker run -p 3838:3838 -v /Users/yijiang/Desktop/Demo_data:/home tidymass/tidymassshiny:latest
```

This command achieves two purposes:
- Starts the Docker image.
- Mounts your working directory to the `/home` path within the container.

**Running the Application**

In terminal, a series of R package loading information will be printed. Until you see the prompt below, tidymassshiny has been successfully running：

```{r, eval=FALSE}
R version 4.3.3 (2024-02-29) -- "Angel Food Cake"
...
...
...
## Until this message show up.
Listening on http://0.0.0.0:3838
```

Then open the browser (Google，Firefox，Edge or Safari), paste the address `http://localhost:3838` in the address bar, and the web page can jump to the tidymass shinyapp page. 

Enjoy your metabolomic data analysis process!

![](figures/docker.png)

![](figures/docker_target.png)



